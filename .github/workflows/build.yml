name: ğŸ—ï¸ Build OpenWrt Base Source

# è§¦å‘æ¡ä»¶ï¼špush, pull_request, å®šæ—¶ï¼ˆæ¯å¤©ï¼‰å’Œæ‰‹åŠ¨è§¦å‘ï¼ˆworkflow_dispatchï¼‰
on:
  #push:
  #  branches:
  #    - main # åªæœ‰åœ¨ main åˆ†æ”¯ push æ—¶è§¦å‘
  #pull_request: # PR æ—¶è§¦å‘
  #schedule:
  #  - cron: '0 0 * * *'  # æ¯å¤©è‡ªåŠ¨è§¦å‘ä¸€æ¬¡
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ› ï¸ è®¾ç½®ç¼–è¯‘ç¯å¢ƒå’Œä¾èµ–
        run: |
          sudo apt update -y
          sudo apt full-upgrade -y
          sudo apt install -y ack antlr3 asciidoc autoconf automake autopoint binutils bison build-essential \
          bzip2 ccache cmake cpio curl device-tree-compiler fastjar flex gawk gettext gcc-multilib g++-multilib \
          git gperf haveged help2man intltool libc6-dev-i386 libelf-dev libfuse-dev libglib2.0-dev libgmp3-dev \
          libltdl-dev libmpc-dev libmpfr-dev libncurses5-dev libncursesw5-dev libpython3-dev libreadline-dev \
          libssl-dev libtool lrzsz mkisofs msmtp ninja-build p7zip p7zip-full patch pkgconf python3 \
          python3-pyelftools python3-setuptools qemu-utils rsync scons squashfs-tools subversion swig texinfo \
          uglifyjs upx-ucl unzip vim wget xmlto xxd zlib1g-dev

      - name: ğŸ“¥ å…‹éš† LEDE æºç 
        run: |
          git clone https://github.com/coolsnowwolf/lede
          cd lede

      - name: ğŸ”„ æ›´æ–° feeds å¹¶å®‰è£…
        run: |
          cd lede
          ./scripts/feeds update -a
          ./scripts/feeds install -a

      - name: ğŸ”§ è®¾ç½®ç¼–è¯‘é…ç½®
        run: |
          cd lede
          # make menuconfig  # è¿™é‡Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®
          make defconfig  # ç”Ÿæˆé»˜è®¤çš„ .config æ–‡ä»¶

      - name: ğŸ“¦ ä¸‹è½½ dl åº“
        run: |
          cd lede
          make download -j8

      - name: âš™ï¸ ç¼–è¯‘å›ºä»¶
        run: |
          cd lede
          make V=s -j$(nproc) #ä½¿ç”¨æ‰€æœ‰ CPU ç¼–è¯‘

      - name: ğŸ“¤ ä¿å­˜å›ºä»¶è¾“å‡º
        uses: actions/upload-artifact@v3
        with:
          name: OpenWrt-Base-Firmware
          path: lede/bin/targets